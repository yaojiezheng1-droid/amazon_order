# PO Import Excel Generator

This script automatically fills the PO_import Excel template with data from JSON files generated by `direct_sku_to_json.py`.

## Features

- Automatically extracts product data from JSON templates
- Fills all required fields according to specified mapping
- Groups products by the same 标识号 (identifier) - **same order name always gets same 标识号**
- Different order names get different 标识号s for proper separation
- Supports warehouse selection from dropdown menu in GUI
- Supports both individual order processing and batch processing
- Integrates with existing workflow

## Usage

### Method 1: Standalone Script

```bash
# Process specific order (e.g., files like myorder-1.json, myorder-2.json)
python fill_po_import.py myorder

# Process with custom warehouse
python fill_po_import.py myorder --warehouse "义乌仓库"

# Process all JSON files in json_exports/
python fill_po_import.py

# Specify custom output filename
python fill_po_import.py myorder --output custom_name.xlsx
```

### Method 2: Integrated with direct_sku_to_json.py

```bash
# Generate JSON files AND PO import Excel in one command
python direct_sku_to_json.py --name myorder --po-import SKU1 100 SKU2 200

# With custom warehouse
python direct_sku_to_json.py --name myorder --po-import --warehouse "义乌仓库" SKU1 100 SKU2 200
```

### Method 3: Batch File (Windows)

```bash
# Convert existing JSON files to PO import
convert_json_to_po_import.bat myorder
```

### Method 4: From product_search_gui.py

The GUI now includes:
- **Warehouse Selection**: Dropdown menu with options loaded from `docs/Storage.txt`
- **Generate PO Import**: Checkbox to enable PO import generation
- When both are used, the `--po-import` and `--warehouse` flags are automatically added to the command

## Field Mapping

The script maps JSON data to Excel columns as follows:

| Excel Column | Source | Value | Notes |
|--------------|--------|-------|-------|
| *标识号 | Generated | Consistent hash based on order name | Same order name = same 标识号 |
| 采购单号 | Filename | Order name from JSON filename (e.g., "myorder-1") | |
| *供应商 | JSON B3 | `cells.B3.value` from JSON | |
| *含税 | Fixed | "是" | |
| *费用分配方式 | Fixed | "按数量" | |
| *采购币种 | Fixed | "CNY" | |
| *采购仓库 | Parameter | Selected warehouse from dropdown/command | From `docs/Storage.txt` |
| *SKU | JSON Product | `产品编号` from products array | |
| *实际采购量 | JSON Product | `数量/个` from products array | |
| *含税单价 | JSON Product | `单价` from products array | |
| 产品备注 | JSON Product | `描述` from products array | |

## Warehouse Configuration

Warehouse options are loaded from `order_generation/docs/Storage.txt`. Each line in the file represents one warehouse option. The GUI will automatically populate the dropdown with these options.

Example `Storage.txt`:
```
默认仓库
义乌仓库
宁波仓库
上海仓库
深圳仓库
```

## 标识号 Logic

- **Consistent**: Same order name always generates the same 标识号
- **Unique**: Different order names get different 标识号s
- **Implementation**: Uses SHA256 hash of order name (first 8 characters)

Examples:
- `test_order` → Always generates `fd72983a`
- `different_order` → Always generates `fd1772ea`
- `test_order` (run again) → Still generates `fd72983a`

## Files Structure

```
order_generation/
├── fill_po_import.py                    # Main script
├── convert_json_to_po_import.bat        # Windows batch file
├── README_po_import.md                  # This documentation
├── docs/
│   ├── PO_import_empty.xlsx            # Template file
│   └── Storage.txt                      # Warehouse options
├── json_exports/                        # Input JSON files
│   ├── myorder-1.json
│   ├── myorder-2.json
│   └── ...
└── PO_import_filled/                    # Output Excel files
    ├── PO_import_myorder.xlsx
    └── ...
```

## Example

1. Generate JSON files with accessories and PO import:
```bash
python direct_sku_to_json.py --name AM2025 --po-import --warehouse "义乌仓库" 2EC-Blue 1000 AM311 500
```

2. Or use standalone script:
```bash
python fill_po_import.py AM2025 --warehouse "义乌仓库"
```

This will create:
- `json_exports/AM2025-1.json`, `AM2025-2.json`, etc. (grouped by supplier)
- `PO_excel_export/AM2025-1.xlsx`, `AM2025-2.xlsx`, etc. (regular Excel format)
- `PO_import_filled/PO_import_AM2025.xlsx` (PO import format with 义乌仓库)

## Requirements

- openpyxl
- hashlib (built-in)
- Python 3.7+

## Integration Notes

- The script respects the same supplier grouping as `direct_sku_to_json.py`
- All products from the same order batch get the same 标识号 for proper grouping
- The 采购单号 uses the order name and factory number (e.g., "AM2025-1", "AM2025-2")
- Fixed values are set according to business requirements
- Warehouse selection is integrated into the GUI workflow
